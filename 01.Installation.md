### Drill Installation

```shell
$ wget http://apache.mesi.com.ar/drill/drill-1.6.0/apache-drill-1.6.0.tar.gz
$ tar xvzf apache-drill-1.6.0.tar.gz
```

### 3rd Party Jars Installation for Azure

```shell
$ cd $DRILL_HOME/jars/3rdparty
$ wget http://central.maven.org/maven2/org/apache/hadoop/hadoop-azure/2.7.1/hadoop-azure-2.7.1.jar
$ wget http://central.maven.org/maven2/com/microsoft/azure/azure-storage/4.2.0/azure-storage-4.2.0.jar
```

### Configuration Drill's core-site.xml

Add Azure Crendential information

```shell
$ cd $DRILL_HOME/conf
$ vi core-site.xml
```

```xml
<configuration>

    <property>
        <name>fs.s3a.access.key</name>
        <value>ENTER_YOUR_ACCESSKEY</value>
    </property>

    <property>
        <name>fs.s3a.secret.key</name>
        <value>ENTER_YOUR_SECRETKEY</value>
    </property>

    <property>
        <name>fs.azure.account.key.YOUR_ACCOUNT.blob.core.windows.net</name>
        <value>YOUR AZURE ACCESS KEY</value>
    </property>

</configuration>
```

![Image of Azure Portal](https://github.com/choochangho/drill-blob/blob/master/images/Azure_Portal.png)

### Running Drill Embeded mode

```shell
$ cd $DRILL_HOME/
$ bin/drill-embedded 
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512M; support was removed in 8.0
5월 02, 2016 9:13:50 오전 org.glassfish.jersey.server.ApplicationHandler initialize
정보: Initiating Jersey application, version Jersey: 2.8 2014-04-29 01:25:26...
apache drill 1.6.0 
"a drill is a terrible thing to waste"
0: jdbc:drill:zk=local>
```

### Create Azure Storage in Drill

Access Drill web UI with your browser( http://localhost:8047 )
Click the tab 'Storage'
Add Storage name as  'azure' in the New Storage Plugin

![Image of Drill Storage](https://github.com/choochangho/drill-blob/blob/master/images/drill_storage_tab.png)

### Define Azure Datastore

```json
{
  "type": "file",
  "enabled": true,
  "connection": "wasb://test4drill@changhotest.blob.core.windows.net/",
  "workspaces": {
    "root": {
      "location": "/",
      "writable": false,
      "defaultInputFormat": null
    },
    "tmp": {
      "location": "/tmp",
      "writable": true,
      "defaultInputFormat": null
    }
  },
  "formats": {
    "psv": {
      "type": "text",
      "extensions": [
        "tbl"
      ],
      "delimiter": "|"
    },
    "csv": {
      "type": "text",
      "extensions": [
        "csv"
      ],
      "delimiter": ","
    },
    "tsv": {
      "type": "text",
      "extensions": [
        "tsv"
      ],
      "delimiter": "\t"
    },
    "parquet": {
      "type": "parquet"
    },
    "json": {
      "type": "json"
    },
    "avro": {
      "type": "avro"
    },
    "sequencefile": {
      "type": "sequencefile",
      "extensions": [
        "seq"
      ]
    },
    "csvh": {
      "type": "text",
      "extensions": [
        "csvh"
      ],
      "extractHeader": true,
      "delimiter": ","
    }
  }
}
```

![Image of Azure Datastore](https://github.com/choochangho/drill-blob/blob/master/images/drill_azure_definition.png)

### Upload Test data to Blob Container using Azure Storage Explorer

![Image of Azure Storage Explorer](https://github.com/choochangho/drill-blob/blob/master/images/azure_storage_explorer.png)

### Test Drill Querying

```shell
0: jdbc:drill:zk=local> SELECT COUNT(*) FROM azure.root.`wp_wpgmza.csv`;
+---------+
| EXPR$0  |
+---------+
| 18      |
+---------+
1 row selected (6.062 seconds)
0: jdbc:drill:zk=local> SELECT COUNT(*) FROM azure.root.`wp_wpgmza.csv.gz`;
+---------+
| EXPR$0  |
+---------+
| 18      |
+---------+
1 row selected (1.183 seconds)
0: jdbc:drill:zk=local> SELECT COUNT(*) FROM azure.root.`/test/wp_wpgmza.csv.gz`;
+---------+
| EXPR$0  |
+---------+
| 18      |
+---------+
1 row selected (1.339 seconds)
0: jdbc:drill:zk=local>
```